<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Grumble</title>

        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <link rel="stylesheet/less" type="text/css" href="/css/main.less">

        <script src="http://cdnjs.cloudflare.com/ajax/libs/labjs/2.0.3/LAB.min.js"></script>

        <!-- start Mixpanel -->
        <script type="text/javascript">
            (function(c,a){
                window.mixpanel=a;
                var b,d,h,e;
                b=c.createElement("script");
                b.type="text/javascript";
                b.async=!0;
                b.src=("https:"===c.location.protocol?"https:":"http:")+'//api.mixpanel.com/site_media/js/api/mixpanel.2.js';
                d=c.getElementsByTagName("script")[0];
                d.parentNode.insertBefore(b,d);
                a._i=[];
                a.init=function(b,c,f){
                    function d(a,b){
                        var c=b.split(".");
                        2==c.length&&(a=a[c[0]],b=c[1]);
                        a[b]=function(){
                            a.push([b].concat(Array.prototype.slice.call(arguments,0)))
                        }
                    }
                    var g=a;
                    "undefined"!==typeof f?g=a[f]=[]:f="mixpanel";
                    g.people=g.people||[];
                    h="disable track track_pageview track_links track_forms register register_once unregister identify name_tag set_config people.set people.increment".split(" ");
                    for(e=0;e<h.length;e++)
                        d(g,h[e]);
                    a._i.push([b,c,f])
                };
                a.__SV=1.1
            })(document,window.mixpanel||[]);
            
            mixpanel.init("6d69541c505047c3d00866c4f0e3e4be");
        </script>
        <!-- end Mixpanel -->

        <script>
            $LAB
            .setOptions({
            })
            .script( "http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" )
            .script( "http://cdnjs.cloudflare.com/ajax/libs/spin.js/1.2.4/spin.min.js" )
            .script( "http://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.4.2/mustache.min.js" )
            .script( "http://cdnjs.cloudflare.com/ajax/libs/less.js/1.3.0/less-1.3.0.min.js" )
            .script( "http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.0.3/bootstrap.min.js" )
            .script( "/javascript/lib/director-1.1.3.js" )
            .script( "/javascript/lib/EventEmitter.min.js" )
            .script( "/javascript/lib/dust-core-1.0.0.js" )
            .script( "/javascript/lib/jquery.idle-timer.js" )
            .script( "/javascript/lib/ba-linkify.min.js" )
            .script( "/javascript/lib/jquery.spin.js" )
            .script( "/javascript/lib/md5.min.js" )
            .script( "/javascript/lib/base64.js" )
            .script( "/socket.io/socket.io.js" )

            .wait() // wait for all our stock libs to be downloaded
            
            .script( "/javascript/utils.js" )

            .script( "/javascript/UserManager.js" )

            .script( "/javascript/chat/IdleHandler.js" )
            .script( "/javascript/chat/MessageRenderer.js" )
            .script( "/javascript/chat/NameHighlighter.js" )
            .script( "/javascript/chat/ScrollHandler.js" )
            .script( "/javascript/chat/UserlistManager.js" )
            .script( "/javascript/chat/MessageHistory.js" )
            .script( "/javascript/chat/TypingStatus.js" )

            .script( "/javascript/views/compiled_templates.js" )
            .script( "/javascript/views/Home.js" )
            .script( "/javascript/views/Room.js" )
            .script( "/javascript/views/Rooms.js" )
            .script( "/javascript/views/MyRooms.js" )
            .script( "/javascript/views/CreateRoom.js" )
            .script( "/javascript/views/ManageRoom.js" )
            .script( "/javascript/views/SignUp.js" )
            .script( "/javascript/views/Settings.js" )

            .script( "/javascript/ConnectionStatus.js" )
            .script( "/javascript/app.js" )

            .wait( function() {
                try
                {
                    var theApp = new App( '/api/1.0' );

                    var theRouter = new Router().configure({
                        notfound: function() {
                            console.log( 'route not found: ' + window.location );
                        }
                    });
            
                    var subsystems = [
                        new UserManager(),
                        new Home(),
                        new Room(),
                        new Rooms(),
                        new MyRooms(),
                        new CreateRoom(),
                        new ManageRoom(),
                        new SignUp(),
                        new Settings(),
                        
                        // chat
                        
                        new MessageRenderer(),
                        new UserlistManager(),
                        new MessageHistory(),
                        new NameHighlighter(),
                        new ScrollHandler(),
                        new TypingStatus()
                    ];
            
                    for ( var index = 0; index < subsystems.length; ++index )
                    {
                        if ( typeof( subsystems[ index ].Bind ) == 'function' )
                        {
                            subsystems[ index ].Bind( theApp, theRouter );
                        }
                    }
                    
                    theApp.Start();
                    theRouter.init(); // start routing
                    
                    if ( window.location.hash == '' )
                    {
                        window.location.hash = '/';
                    }
            
                    for ( var index = 0; index < subsystems.length; ++index )
                    {
                        if ( typeof( subsystems[ index ].Start ) == 'function' )
                        {
                            subsystems[ index ].Start();
                        }
                    }
                }
                catch( e )
                {
                    var callstack = [];
                    if ( e.stack ) {
                        var lines = e.stack.split('\n');
                        for (var i=0, len=lines.length; i<len; i++) {
                            if (lines[i].match(/^\s*[A-Za-z0-9\-_\$]+\(/)) {
                                callstack.push(lines[i]);
                            }
                        }
                    }
                    console.error( e.message + "\n" + callstack.join( "\n" ) );
                }
            });
        </script>
        
    </head>

    <body>
        <audio src="/sounds/message.mp3" id="message-sound"></audio>
        
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="brand" href="#/">Grumble</a>
                    <ul class="nav">
                        <li class="navItem unauthenticated" id="nav-signup"><a href="#/SignUp"><i class="icon-user icon-white"></i> Sign Up!</a></li>
                        <li class="navItem" id="nav-rooms"><a href="#/Rooms"><i class="icon-comment icon-white"></i> Rooms</a></li>
                        <li class="navItem authenticated" id="nav-myrooms"><a href="#/MyRooms"><i class="icon-comment icon-white"></i> My Rooms</a></li>
                        <li class="navItem authenticated" id="nav-createroom"><a href="#/CreateRoom"><i class="icon-plus-sign icon-white"></i> Create Room</a></li>
                        <li class="navItem authenticated" id="nav-settings"><a href="#/Settings"><i class="icon-cog icon-white"></i> Settings</a></li>
                        <li class="navItem" id="nav-feedback"><a href="https://github.com/andyburke/grumble/issues" target="_blank"><i class="icon-tag icon-white"></i> Bug/Feature Request</a></li>
                    </ul>
                    <ul class="nav pull-right">
                        <li class="navItem"><a href="" onclick="return false;"><i id="server-connection-status" class=""></i> &nbsp;</a></li>
                    </ul>
                    <form id="topbar-signin-form" class="navbar-form pull-right form-inline unauthenticated">
                        <input class="input-medium" type="text" name="email" placeholder="Email">
                        <input class="input-medium" type="password" name="password" placeholder="Password">
                        <button class="btn button-signin" type="submit"><i class="icon-user"></i> Sign In</button>
                    </form>
                    <form id="topbar-signout-form" class="navbar-form pull-right form-inline authenticated">
                        <button id="topbar-signout-button" class="btn pull-right button-signout" type="submit"><i class="icon-user"></i> Sign Out</button>
                    </form>
                </div>
            </div>
        </div>
    
        <div id="signup-modal" class="modal hide">
            <div class="modal-header">
                <a class="close" data-dismiss="modal">x</a>
                <h3>Sign Up!</h3>
            </div>
            <div class="row modal-body">
                <div class="span3">
                    <form id="signup-form">
                        <fieldset>
                            <input type="text" class="pull-right" name="nickname" placeholder="Nickname" />
                            <div class="clear"></div>
                            <input type="text" class="pull-right" name="email" placeholder="Email" />
                            <div class="clear"></div>
                            <input type="password" class="pull-right" name="password" placeholder="Password" />
                            <div class="clear"></div>
                            <input type="submit" class="button-signup pull-right btn btn-primary" id="signup-modal-signup-button" value="Sign Up!" />
                        </fieldset>
                    </form>
                </div>
                <div class="span3 extra">
                    <h3>Sign Up To Enter Rooms!</h3>
                    When you sign up, you can set your nickname and avatar!
                    <p/>
                    <p/>
                    We'll never reveal your email address to a third party.  Ever.
                </div>
            </div>
        </div>
    
        <div class="container-fluid">
            <div class="content" id="main">
            </div>
        </div>

    </body>
</html>
